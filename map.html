<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<meta http-equiv="Content-Script-Type" content="text/javascript">
		<meta http-equiv="Content-Style-Type" content="text/css">
		<title>ITAhM::Map</title>
		<link rel="stylesheet" href ="frame.css ">
		<style>
#toolbar {
	background-color: #ddd;
}

#toolbar.minimized #minimize {
	display: none;
}

#container {
	position: fixed; top: 10px; right: 10px; bottom: 10px; left: 10px;
}
		</style>
	
		<script src="js/Draggable.js"></script>
		<script src="js/Canvas.js"></script>
			
	</head>
	
	<body>
		<div id="container"></div>
		<script>

var elements = {
		container: document.getElementById("container")
	};
	

(function (window, root) {
	
	var canvas = new Canvas(elements.container);
	
	canvas.ondraw = function (context, hitContext, data) {
		context.save();
		context.fillStyle = data.color;
		context.fillRect(data.x, data.y, 50, 50);
		context.restore();
		
		hitContext.fillRect(data.x, data.y, 50, 50);
	}
	
	canvas.onenter = function (node) {
	}
	
	canvas.onleave = function (node) {
	}
	
	var layer = canvas.add();
	var node1 = layer.add({x: Math.random() * 300 -150, y:Math.random() * 300 -150, color: "#f00"});
	var node2 = layer.add({x: Math.random() * 300 -150, y:Math.random() * 300 -150, color: "#0f0"});
	var node3 = layer.add({x: Math.random() * 300 -150, y:Math.random() * 300 -150, color: "#00f"});
	
	layer.invalidate();
	
	canvas.invalidate();
	
	function onSelect() {
		var node = canvas.node;
		
		if (node) {
			node.layer.top(node);
		}
	}
	
	canvas.ondragstart = function (e) {
	}
	
	canvas.ondragmove = function (e) {
		if (e.node) {
			e.node.data.x += e.moveX;
			e.node.data.y += e.moveY;
			
			e.node.layer.invalidate();
			
			canvas.invalidate();
		}
		else {
			canvas.translate(e.dragX, e.dragY);
		}
	}

	canvas.ondragend = function (e) {
		if (!e.node) {
			node1.data.x += e.dragX;
			node2.data.x += e.dragX;
			node3.data.x += e.dragX;
			
			node1.data.y += e.dragY;
			node2.data.y += e.dragY;
			node3.data.y += e.dragY;
			
			layer.invalidate();
			
			canvas.invalidate();
		}
	}
	
	

	elements.container.addEventListener("mousedown", onSelect, false);
	
}) (window, top);
		</script>
	
	</body>
	
</html>