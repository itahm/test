<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<meta http-equiv="Content-Script-Type" content="text/javascript">
		<meta http-equiv="Content-Style-Type" content="text/css">
		<title></title>
		
		<style>
body,
h1 {
	font-family: tahoma, arial, "맑은 고딕"; 
}

iframe {
	/*position: absolute; top: 0; right: 0; bottom: 0; left: 0;*/
	width: 100%; height: 100%;
	margin: 0;
	padding: 0;
	border: 0;
}

.iframe {
	position: fixed; width: 50%; height: 50%;
}

.iframe.tl {
	top: 0; left: 0;
}

.iframe.tr {
	top: 0; right: 0;
}

.iframe.bl {
	bottom: 0; left: 0;
}

.iframe.br {
	bottom: 0; right: 0;
}

		</style>
		
	</head>
	
	<body>
	
		<div class="iframe tl">
			<iframe id="frame_list"></iframe>
		</div>
		<div class="iframe tr">
			<iframe id="frame_map"></iframe>
		</div>
		<div class="iframe bl">
			<iframe id="frame_device"></iframe>
		</div>
		<div class="iframe br">
			<iframe id="frame_event"></iframe> 
		</div>
		
		<div id="toolbar" class="minimized">
			<img id="maximize" src="img/maximize.png">
			<img id="minimize" src="img/minimize.png">
		</div>
		
		<script>

(function (window, undefined){
	
	var elements = {
			toolbar: document.getElementById("toolbar"),
			maximize: document.getElementById("maximize"),
			minimize: document.getElementById("minimize"),
			frame: {
				list: document.getElementById("frame_list"),
				map : document.getElementById("frame_map"),
				device: document.getElementById("frame_device"),
				event: document.getElementById("frame_event")
			}
		},
		loader = new Worker("worker/loader.js"),
		deviceList, iconList,
		iconMap;
	
	loader.onmessage = function (e) {
		deviceList = e.data.device;
		iconList = e.data.icon;
		
		loadIcon(function (map) {
			iconMap = map;
			
			/**
			 * icon 모두 load 된 후 페이지 시작
			 */
			load();
		});
	}
	
	/**
	 * 페이지 시작점
	 */
	function load() {
		elements.maximize.addEventListener("click", function (e) {
			/*var iframe = elements.toolbar.parentNode;
			
			document.body.classList.add("maximized");
			document.body.classList.remove("minimized");
			
			iframe.classList.add("maximized");*/
			
			elements.toolbar.classList.add(maximized);
		}, false);
		
		elements.minimize.addEventListener("click", function (e) {
			/*var iframe = elements.toolbar.parentNode;
			
			document.body.classList.remove("maximized");
			document.body.classList.add("minimized");
			
			iframe.classList.remove("maximized");*/
			elements.toolbar.classList.add(minimized);
		}, false);
		
		elements.frame.list.src = "list.html";
		elements.frame.map.src = "map.html";
		elements.frame.device.src = "device.html";
		elements.frame.event.src = "event.html";
	}
	
	function loadIcon(complete) {
		var names = Object.keys(iconList),
			length = names.length,
			icon = new Image(),
			index = 0,
			map = {};
		
		icon.onload = onLoad;
		icon.src = iconList[names[index]].src;
		
		function onLoad() {
			map[names[index]] = this;
			
			if (++index < length) {
				icon = new Image();
				icon.onload = onLoad;
				icon.src = iconList[names[index]].src;
			}
			else {
				complete(map);
			}
		}
	}
	
	window.getDeviceList = function () {
		return deviceList;
	};
	
	window.getDevice = function (id) {
		return deviceList[id];
	};
	
	window.getIconData = function (type) {
		return iconList[type];
	};
	
	window.selectDevice = function (id) {
		elements.frame.device.contentWindow.resetDevice(id);
		elements.frame.map.contentWindow.selectDevice(id);
	};
	
	window.getIconMap = function () {
		return iconMap;
	};
	
	window.removeDevice = function (id) {
		console.log("remove >> "+ id);
	};
	
}) (window);

		</script>
	
	</body>
	
</html>